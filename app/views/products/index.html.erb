<h1>Products</h1>
<%= form_with url: '/search', method: :get do |form| %>
  <%= form.text_field :search, placeholder: 'Name of product', require: true %>
  <%= form.submit 'Search Product' %>
<% end %>
<% if current_user.nil? || current_user&.customer? %>
  <% if session[:order_id] %>
    <%= link_to 'Show shopping cart', @virtual_order, style: 'display: block' %>
  <% end %>
<% end %>
<% if policy(Product).new? %>
  <%= link_to 'New Product', new_admin_product_path %>
<% end %>
<div>
  <ul>
    <% @products.each do |product| %>
      <li>
        <div>
          <p>
            <%= product.sku %>
          </p>
          <h2>
            <%= product.name %>
          </h2>
          <p>
            <%= product.description %>
          </p>
          <p>
            $ <%= product.price %>
          </p>
          <%= link_to 'Show', product, style: 'display: block' %>
          <% if policy(product).edit? %>
            <%= link_to 'Edit', edit_admin_product_path(product) %>
          <% end %>
          <% if policy(product).destroy? %>
            <%= button_to 'Delete', admin_product_path(product), method: :delete %>
          <% end %>
          <% if policy(OrderLine).new? %>
            <%= link_to 'Add to cart', new_product_order_line_path(product) %>
          <% end %>
        </div>
      </li>
    <% end %>
  </ul>
</div>