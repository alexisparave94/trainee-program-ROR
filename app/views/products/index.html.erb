<div class="d-flex justify-content-center">
  <div class="col-sm-6 col-md-6 col-lg-8">
    <%= form_with url: '/search', method: :get, class:"d-flex", role:"search" do |form| %>
      <%= form.text_field :search, placeholder: 'Name of product', require: true, class:"form-control me-2", type:"search", 'aria-label':"Search" %>
      <%= button_tag class: "btn btn-outline-primary" do %>
        <i class="bi bi-search"></i>
      <% end %>
      <%# form.submit 'Search', class:"btn btn-outline-primary" %>
    <% end %>
  </div>
</div>
<div class='mb-2 mt-4 ps-3'>
  <h1>Products</h1>
</div>
<div class='container-md d-flex mb-3 gap-2'>
  <% if policy(Product).new? %>
    <%= link_to 'New Product', new_admin_product_path, class:'btn btn-primary' %>
  <% end %>
  <% if policy(ChangeLog).index? %>
    <%= link_to admin_change_logs_path, class:'btn btn-secondary' do %>
      <i class="bi bi-file-earmark-text"></i>
    <% end %>
  <% end %>
  <% if current_user.nil? || current_user&.customer? %>
    <% if session[:order_id] %>
      <%= link_to @virtual_order, class:'btn btn-primary' do %>
        <i class="bi bi-cart3"></i>
      <% end %>
    <% end %>
  <% end %>
</div>
<div class='container-md d-flex flex-column gap-4'>
  <% @products.each do |product| %>
    <div class="card px-4 py-3" style="">
      <div class="card-body">
        <h6 class="card-subtitle mb-2 text-muted"><%= product.sku %></h6>
        <h5 class="card-title"><%= product.name %></h5>
        <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
        <h6 class="card-subtitle mb-2 text-muted">$ <%= product.price %></h6>
        <%# link_to 'Show', product, class:'btn btn-primary' %>
        <div class='mt-3 d-flex justify-content-between align-items-center'>
          <div>
            <% if policy(Like).create? %>
              <% if product.likes.where(user_id: current_user.id).take %>
                <%= link_to [:customer, product.likes.where(user_id: current_user.id).take], data: {turbo_method: :delete}, class:'btn fs-4' do %>
                  <i class="bi bi-star-fill text-info"></i>
                <% end %>
              <% else %>
                <%= link_to customer_likes_path(product_id: product.id), data: {turbo_method: :post}, class:'btn btn-ligth fs-4' do %>
                  <i class="bi bi-star"></i>
                <% end %>
              <% end %>
            <% end %>
          </div>
          <div>
            <% if policy(product).edit? %>
              <%= link_to edit_admin_product_path(product), class:'btn btn-primary' do %>
                <i class="bi bi-pencil"></i>
              <% end %>
            <% end %>
            <% if policy(product).destroy? %>
              <%= link_to admin_product_path(product), data: { turbo_method: :delete }, class:'btn btn-danger' do %>
                <i class="bi bi-trash"></i>
              <% end %>
            <% end %>
            <% if policy(OrderLine).new? %>
              <%= link_to 'Add to cart', new_product_order_line_path(product), class:'btn btn-primary' %>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>