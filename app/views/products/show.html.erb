<p>
  <%= @commentable.sku %>
</p>
<h1><%= @commentable.name %></h1>
<p>
  <%= @commentable.description %>
</p>
<p>
  <div class='d-flex gap-2'>
    Tags: 
    <% if @commentable.tags.empty? %>
      No tags assigned
    <% else %>
      <% @commentable.tags.each do |tag| %>
        <div><%= tag.name %></div>
      <% end %>
    <% end %>
  </div>
</p>
<p>
  $ <%= @commentable.price %>
</p>
<p>
  Stock: <%= @commentable.stock %>
</p>
<p>
  Rate: <%= @comment.rate || 'No rated' %>
</p>
<% if current_user&.admin? %>
  <div class='mb-3'>
    <h4>Add tags</h4>
    <div>
      <%= form_with url: add_tag_admin_product_path(@commentable) do |f|%>
        <%= f.collection_select :tag_id, (Tag.all - @commentable.tags), :id, :name, include_blank: "-- Select Tag" %>
        <%= f.submit "Add Tag", class: 'btn btn-primary' %>
      <% end %>
    </div>
  </div>
<% end %>
<h4>Add a comments</h4>
<div data-turbo='false'>
  <%= form_with model: [@commentable, @comment] do |form| %>
    <div class="field mb-3">
      <%= form.text_area :description, class: 'form-control' %>
      <div class='mt-3'>
        <% unless @comment.errors.messages_for(:description).empty? %>
          <% @comment.errors.messages_for(:description).each do |message| %>
            <p class='text-danger fw-semibold'>* <%= message %></p>
          <% end %>
        <% end %>
      </div>
      <%= form.label :rate, class:'form-label' %>
      <em>(If you want you could rate or update your rate)</em>
      <%= form.text_field :rate, class: 'form-control' %>
      <div class='mt-3'>
        <% unless @comment.errors.messages_for(:rate).empty? %>
          <% @comment.errors.messages_for(:rate).each do |message| %>
            <p class='text-danger fw-semibold'>* <%= message %></p>
          <% end %>
        <% end %>
      </div>
    </div>
    <div class="d-grid mb-3">
      <%= form.submit 'Add Comment', class: 'btn btn-primary' %>
    </div>
  <% end %>
</div>
<div>
  <% if @commentable.comments.empty? %>
    <h4>No Comments</h4>
  <% else %>
    <h4>Comments</h4>
    <% @commentable.comments.each do |comment| %>
      <hr>
      <p><%= comment.description %></p>
      <p>By <%= comment.user.first_name %></p>
      <p><%= time_ago_in_words(comment.created_at) %></p>
    <% end %>
  <% end %>
</div>