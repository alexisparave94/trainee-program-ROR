<h1>Current Cart</h1>
<div>
  <% if @virtual_order.order_lines.empty? %>
    <p>
      Your cart its empty
    </p>
  <% else %>
    <ul>
      <% @virtual_order.order_lines.each do |order_line| %>
        <li>
          <div>
            <h3>
              <%= order_line.product.name %>
            </h3>
            <p>
              <%= order_line.quantity %>
            </p>
            <p>
              $ <%= order_line.price %>
            </p>
            <p>
              Subtotal: $ <%= order_line.total %>
            </p>
            <%# link_to 'Edit', edit_order_line_path(detail['order_line']['product_id']) %>
            <%# button_to 'Delete', order_line_path(detail['order_line']['product_id']), method: :delete %>
          </div>
        </li>
      <% end %>
    </ul>
    <h4>Total: $ <%= @virtual_order.calculate_total %></h4>
    <h4>Total: $ <%= @virtual_order.id %></h4>
    <%# button_to 'Empty cart', order_url(id: 1), method: :delete %>
    <%# link_to 'Checkout', checkout_path %>
    <% unless @lines_exceed_stock.nil? %>
      <% if @lines_exceed_stock.empty? %>
        </p> 
          There is enough stock, you can buy the products
        <p>
        <div data-turbo='false'>
          <%= button_to 'Buy', customer_orders_path %>
        </div>
      <% else %>
        <ul>
          <% @lines_exceed_stock.each do |line| %>
            <li>
              <%= "There is only a stock of #{line[:stock]} for #{line[:product]['name']}" %>
            </li>
          <% end %>
        </ul>
      <% end %>
    <% end %>
  <% end %>
</div>